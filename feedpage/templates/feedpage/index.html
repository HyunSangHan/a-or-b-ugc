{% extends 'base.html' %}
{% load custom_tags %}

{% block content %}

{% if is_searched and search_result_num != 0 %}
    <p>{{ search_result_num }}개의 검색결과가 있습니다.</p>
    <hr>
    {% endif %}

    {% for feed in feeds %}
    {% if feed.editnow %}
    <div style="border: 1px solid grey;">
        <a href="/feeds/{{ feed.id }}/editoff">수정안하기</a>
        <form action="/feeds/{{feed.id}}/" method="POST">
    {% comment %} /{{ feed.id }} {% endcomment %}
        {% csrf_token %} 
        <!--csrf_token은 보안을 위해 추가하는 것임-->
        {% comment %} <p>잠김여부 : {{feed.editnow}} </p> {% endcomment %}
        {% comment %} <p>title</p> {% endcomment %}
        <input name="title" value="{{feed.title}}"/> <br />
        {% comment %} <p>content</p> {% endcomment %}
        A: <input name="content_a" value="{{feed.content_a}}"/> <br />
        B: <input name="content_b" value="{{feed.content_b}}"/> <br />
        <input type="submit" value="반영하기" />
        </form>
    </div>
    {% else %}

<ul style = "padding: 0;">
    <li style="border: 0px solid grey; padding-bottom: 50px; list-style-type: none;">
        {% comment %} <p>잠김여부 : {{feed.editnow}} </p> {% endcomment %}
        <h3>{{ feed.title }}</h3>
        <span style="width: 100%; display: inline-flex;">
            <div style = "width: 45vw; border-radius: 25px; min-height: 45vw; background-color: white; text-align: center; display: flex; justify-content: center; flex-direction: column; margin: auto;">
                <a href="/feeds/{{ feed.id }}/upvote_a">
                <h4 style="width: 100%;">A</h4>
                </a>
                {{feed.content_a}}
                <p style="width: 100%;">
                {% get_upvote_a feed.id %}표({% get_upvote_perc_a feed.id %})
                </p>
            </div>
            <div style = "width: 45vw; border-radius: 25px; min-height: 45vw; background-color: white; text-align: center; display: flex; justify-content: center; flex-direction: column; margin: auto;">
                <a href="/feeds/{{ feed.id }}/upvote_b">
                <h4 style="width: 100%;">B</h4>
                </a>
                {{feed.content_b}}
                <p style="width: 100%;">
                {% get_upvote_b feed.id %}표({% get_upvote_perc_b feed.id %})
                </p>
            </div>
        </span>
        신고 : {{feed.report}}<br/>
        <a href="/feeds/{{ feed.id }}">더보기</a>
        {% if request.user == feed.creator %}
        <a href="/feeds/{{ feed.id }}/edit?next={{request.path}}?page={{feeds.number}}">수정하기</a>
        {% comment %}  {% endcomment %}
        <a href="/feeds/{{ feed.id }}/editon">당장수정하기</a>
        <a href="/feeds/{{ feed.id }}/delete" onclick="return confirm('ㄹㅇ 삭제?')">삭제</a>
        {% endif %}

    <!-- 팔로우 코드 -->
          <!--수정!-->
    <p>작성자:<strong>{{feed.creator.username}}</strong>
      (following: {{ feed.creator.profile.follow_to.all.count }} / follower: {{ feed.creator.profile.follow_from.all.count }})
       {% if user.is_authenticated %}
        {% if request.user != feed.creator %}
           <a href="/feeds/{{ feed.creator.id }}/follow">
             {% if request.user.profile not in feed.creator.profile.follows.all %}
                팔로우
             {% else %}
                팔로우 취소
             {% endif %}
           </a>
        {% endif %}
        {% endif %}
    </p>
    <!-- 댓글 코드 -->
    <p/>
    {% for c in feed.feedcomment_set.all %}
    [{{c.about_a}}] {{ c.content }}
    {% if request.user == c.reactor %}
    <form action="/feeds/{{ feed.id }}/comments/{{ c.id }}/" method="POST">
        {% csrf_token %}
        <button>댓글 삭제</button>
    </form>
    {% endif %}
    <br>
    {% endfor %}
    <form action="/feeds/{{ feed.id }}/comments/" method="POST">
    {% csrf_token %}
    <input type="text" name="content" />
    <input type="hidden" name="about_a" value=True />
    <button type="submit">댓글 달기</button>
    </form>
    <!-- 댓글 코드 끝 -->

    </li>
</ul>
</div>
    {% endif %}
    {% endfor %} 

    {% if search_result_num == 0 %}
        <div>검색결과가 없습니다. <a href="/feeds/new">작성하기</a>를 눌러 <strong>{{ keyword }}</strong>에 대한 첫번째 글을 작성해보세요!</div>
    {% else %}
        {% if feeds.has_previous %}
        <a href="?page=1">First</a>
        <a href="?page={{feeds.previous_page_number}}">Previous</a>
        {% endif %}
        <span>{{feeds.number}}</span>
        <span>of</span>
        <span>{{feeds.paginator.num_pages}}</span>
    {% endif %}

    {% if feeds.has_next %}
    <a href="?page={{feeds.next_page_number}}">Next</a>
    <a href="?page={{feeds.paginator.num_pages}}">Last</a>
    {% endif %}

{% endblock content %}